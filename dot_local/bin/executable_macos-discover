#!/usr/bin/env bash
# Discover current macOS settings
# Usage: macos-discover [domain]
#
# Examples:
#   macos-discover                    # Show all interesting settings
#   macos-discover com.apple.dock     # Show all Dock settings
#   macos-discover finder             # Show Finder settings (smart search)

set -euo pipefail

# Color output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

print_header() {
    echo -e "\n${BLUE}=== $1 ===${NC}"
}

print_setting() {
    local domain=$1
    local key=$2
    local value
    value=$(defaults read "$domain" "$key" 2>/dev/null || echo "not set")
    echo -e "${GREEN}$key${NC}: $value"
}

# If domain specified, show all settings for that domain
if [[ $# -gt 0 ]]; then
    domain=$1

    # Smart domain matching
    case "$domain" in
        dock)
            domain="com.apple.dock"
            ;;
        finder)
            domain="com.apple.finder"
            ;;
        safari)
            domain="com.apple.Safari"
            ;;
        terminal)
            domain="com.apple.terminal"
            ;;
        screenshots|screencapture)
            domain="com.apple.screencapture"
            ;;
    esac

    print_header "All settings for $domain"
    defaults read "$domain" 2>/dev/null || echo "Domain not found or no settings"
    exit 0
fi

# Show interesting settings
print_header "Keyboard Settings"
print_setting NSGlobalDomain KeyRepeat
print_setting NSGlobalDomain InitialKeyRepeat
print_setting NSGlobalDomain ApplePressAndHoldEnabled
print_setting NSGlobalDomain AppleKeyboardUIMode

print_header "Trackpad Settings"
print_setting com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking
print_setting com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadThreeFingerDrag
print_setting NSGlobalDomain com.apple.trackpad.scaling

print_header "Dock Settings"
print_setting com.apple.dock tilesize
print_setting com.apple.dock magnification
print_setting com.apple.dock largesize
print_setting com.apple.dock autohide
print_setting com.apple.dock autohide-delay
print_setting com.apple.dock show-recents
print_setting com.apple.dock orientation

print_header "Finder Settings"
print_setting NSGlobalDomain AppleShowAllExtensions
print_setting com.apple.finder AppleShowAllFiles
print_setting com.apple.finder ShowPathbar
print_setting com.apple.finder ShowStatusBar
print_setting com.apple.finder FXPreferredViewStyle
print_setting com.apple.finder FXDefaultSearchScope

print_header "Screenshot Settings"
print_setting com.apple.screencapture location
print_setting com.apple.screencapture type
print_setting com.apple.screencapture disable-shadow

print_header "Safari Settings"
print_setting com.apple.Safari ShowFullURLInSmartSearchField
print_setting com.apple.Safari IncludeDevelopMenu
print_setting com.apple.Safari SendDoNotTrackHTTPHeader

print_header "General UI/UX"
print_setting NSGlobalDomain NSAutomaticCapitalizationEnabled
print_setting NSGlobalDomain NSAutomaticSpellingCorrectionEnabled
print_setting NSGlobalDomain NSAutomaticQuoteSubstitutionEnabled
print_setting com.apple.LaunchServices LSQuarantine

echo -e "\n${YELLOW}Tip:${NC} To see all domains: defaults domains | tr ',' '\\n' | sort"
echo -e "${YELLOW}Tip:${NC} To see a specific domain: macos-discover com.apple.dock"
echo -e "${YELLOW}Tip:${NC} To compare before/after: defaults read > before.txt"
